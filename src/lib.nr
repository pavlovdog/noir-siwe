mod siwe;
mod utils;

#[test]
fn test_siwe() {
    let message = [
        104, 116, 116, 112, 115, 58, 47, 47, 108, 111, 99, 97, 108, 104, 111, 115, 116, 32, 119, 97,
        110, 116, 115, 32, 121, 111, 117, 32, 116, 111, 32, 115, 105, 103, 110, 32, 105, 110, 32,
        119, 105, 116, 104, 32, 121, 111, 117, 114, 32, 69, 116, 104, 101, 114, 101, 117, 109, 32,
        97, 99, 99, 111, 117, 110, 116, 58, 10, 48, 120, 55, 66, 49, 97, 70, 69, 50, 55, 52, 53, 53,
        51, 51, 68, 56, 53, 50, 100, 54, 102, 68, 53, 65, 54, 55, 55, 70, 49, 52, 99, 48, 55, 52,
        50, 49, 48, 100, 56, 57, 54, 10, 10, 83, 105, 103, 110, 32, 105, 110, 32, 119, 105, 116,
        104, 32, 69, 116, 104, 101, 114, 101, 117, 109, 32, 116, 111, 32, 116, 104, 101, 32, 97,
        112, 112, 46, 10, 10, 85, 82, 73, 58, 32, 104, 116, 116, 112, 58, 47, 47, 108, 111, 99, 97,
        108, 104, 111, 115, 116, 58, 51, 48, 48, 48, 10, 86, 101, 114, 115, 105, 111, 110, 58, 32,
        49, 10, 67, 104, 97, 105, 110, 32, 73, 68, 58, 32, 49, 10, 78, 111, 110, 99, 101, 58, 32,
        57, 101, 101, 49, 55, 100, 54, 102, 98, 54, 54, 51, 48, 50, 102, 55, 55, 52, 56, 53, 102,
        101, 101, 101, 51, 53, 52, 50, 98, 49, 50, 100, 52, 49, 50, 53, 56, 49, 100, 50, 56, 52, 99,
        101, 53, 98, 51, 49, 48, 102, 49, 51, 57, 51, 57, 55, 51, 50, 51, 57, 56, 101, 56, 57, 98,
        48, 49, 101, 97, 55, 52, 102, 51, 101, 51, 54, 51, 98, 52, 56, 49, 53, 98, 99, 54, 102, 56,
        55, 99, 102, 49, 56, 55, 54, 55, 53, 10, 73, 115, 115, 117, 101, 100, 32, 65, 116, 58, 32,
        50, 48, 50, 52, 45, 49, 50, 45, 50, 54, 84, 49, 57, 58, 49, 57, 58, 52, 51, 46, 55, 56, 52,
        90,
    ];

    let pub_key_x = [
        230, 196, 122, 230, 150, 44, 94, 161, 85, 159, 72, 180, 55, 193, 147, 161, 188, 177, 215,
        45, 8, 215, 93, 116, 59, 163, 203, 251, 142, 122, 251, 235,
    ];

    let pub_key_y = [
        225, 194, 126, 64, 200, 136, 62, 125, 212, 223, 147, 17, 205, 236, 164, 2, 69, 215, 237,
        231, 70, 186, 13, 114, 120, 175, 17, 166, 228, 38, 235, 156,
    ];

    let signature = [
        160, 60, 129, 56, 201, 160, 30, 6, 205, 118, 43, 182, 80, 61, 210, 191, 86, 243, 139, 252,
        212, 53, 133, 9, 36, 121, 76, 63, 153, 147, 29, 115, 83, 167, 254, 235, 16, 137, 89, 180,
        86, 252, 98, 219, 96, 5, 98, 139, 248, 179, 220, 47, 219, 38, 104, 85, 9, 30, 255, 150, 188,
        117, 153, 69,
    ];

    let siwe = siwe::SiweMessage::from_message(message);

    assert(siwe.chainId == 1, "Chain ID is not 1");

    let result = siwe.ecrecover(pub_key_x, pub_key_y, signature);

    assert(result == 0x7b1afe2745533d852d6fd5a677f14c074210d896, "Ecrecover failed");
    assert(siwe.address == 0x7b1afe2745533d852d6fd5a677f14c074210d896, "Address is not correct");
}
